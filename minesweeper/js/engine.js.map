{"version":3,"sources":["src/engine.js"],"names":[],"mappings":"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","file":"engine.js","sourcesContent":["import Block from 'js/block';\n\nexport default class MineSweeper {\n    constructor(options) {\n        this.options = options;\n\n        this._initGame();\n        this._initMap();\n        this._startGame();\n    }\n\n    _initGame() {\n        this.gameArea = document.getElementById(this.options.gameArea);\n\n        // level selector\n        this.levelSelector = document.createElement('p');\n        this.levelSelector.innerHTML = '<a>Easy</a><a>Normal</a><a>Hard</a>';\n        this.gameArea.appendChild(this.levelSelector);\n\n        this.levelSelector.addEventListener('click', (event)=> {\n            if (event.srcElement.nodeName === 'A') {\n                this.setLevel(event.srcElement.innerText.toLowerCase());\n            }\n        });\n\n        //mines left, face, and timer;\n        const digitalWrapper = document.createElement('div');\n        this._mines = document.createElement('span');\n        this._time = document.createElement('span');\n        this._time.innerHTML = '000';\n        this._face = document.createElement('div');\n\n        digitalWrapper.appendChild(this._mines);\n        digitalWrapper.appendChild(this._face);\n        digitalWrapper.appendChild(this._time);\n        this.gameArea.appendChild(digitalWrapper);\n\n        this._face.addEventListener('click', (event)=> {\n            const target = event.srcElement;\n            target.className = 'normal';\n            this._initMap();\n        });\n\n        // game canvas\n        this.canvas = document.createElement('canvas');\n        this.canvas.innerText = 'Your browser does not support canvas, please upgrade your browser.';\n        this.gameArea.appendChild(this.canvas);\n\n        // init block\n        Block.size = this.options.blockSize;\n        Block.ctx = this.canvas.getContext('2d');\n\n        // prevent context menu\n        window.addEventListener('contextmenu', function (event) {\n            event.preventDefault();\n        });\n    }\n\n    _initMap() {\n        // set mines count\n        this._mines.innerText = this._addZero(this.options.mineCount);\n\n        this.gameArea.style.width = this.options.blockSize * this.options.columns / 2 + 'px';\n        // for retina display\n        this.canvas.width = this.options.blockSize * this.options.columns;\n        this.canvas.height = this.options.blockSize * this.options.rows;\n        this.canvas.style.width = this.options.blockSize * this.options.columns / 2 + 'px';\n        this.canvas.style.height = this.options.blockSize * this.options.rows / 2 + 'px';\n\n        this.firstClick = true;\n        this.gameOver = false;\n        this.win = false;\n        this._face.className = 'normal';\n        clearInterval(this.timer);\n\n        this.map = [];\n        for (let i = 0; i < this.options.rows; i++) {\n            this.map[i] = [];\n            for (let j = 0; j < this.options.columns; j++) {\n                this.map[i][j] = new Block('cover', 0, i, j);\n                this.map[i][j].draw(false);\n            }\n        }\n    }\n\n    _setMines(coor) {\n        // generate mines\n        const mines = [];\n        for (let i = 0; i < this.options.rows * this.options.columns; i++) {\n            if (i < this.options.mineCount) {\n                mines[i] = -1;\n            } else {\n                mines[i] = 0;\n            }\n        }\n\n        // shuffle mines\n\n        // use [Fisher-Yates shuffle] to shuffle mines\n        for (let i = 1; i < this.options.rows * this.options.columns; i++) {\n            const ran = Math.ceil(Math.random() * i);\n\n            let temp = mines[i];\n            mines[i] = mines[ran];\n            mines[ran] = temp;\n        }\n\n        // the block at first click position can not be mine\n        const firstPosition = coor.i * this.options.rows + coor.j;\n        while (mines[firstPosition] === -1) {\n            const ran = Math.ceil(Math.random() * this.options.rows * this.options.columns)\n            if (mines[ran] === 0) {\n                let temp = mines[firstPosition];\n                mines[firstPosition] = mines[ran];\n                mines[ran] = temp;\n            }\n        }\n\n        // set mines\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                this.map[i][j].number = mines[i * this.options.rows + j];\n            }\n        }\n\n        // calculate numbers\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                if (this.map[i][j].number !== -1) {\n                    for (let x = i - 1; x <= i + 1; x++) {\n                        for (let y = j - 1; y <= j + 1; y++) {\n                            if (x < this.options.rows && x >= 0 && y < this.options.columns && y >= 0 && this.map[x][y].number === -1) {\n                                this.map[i][j].number++;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        // this._shownMap();\n\n        // set timer\n        this._time.innerText = '000';\n        this.timer = setInterval(()=> {\n            this.time = 'add';\n        }, 1000);\n    }\n\n    _updateMap(button, method, coor) {\n        // gameover, do not respond any click event\n        if (this.gameOver || this.win) {\n            return;\n        }\n        // set face\n        if ((button === 'l' || button === 'lr') && method === 'down') {\n            this._face.className = 'click';\n        } else if (method === 'up') {\n            this._face.className = 'normal';\n        }\n        // for r & down\n        if (button === 'r') {\n            switch (this.map[coor.i][coor.j].type) {\n                case 'cover':\n                    this.map[coor.i][coor.j].type = 'flag';\n                    this.mines = -1;\n                    break;\n                case 'flag':\n                    this.map[coor.i][coor.j].type = 'question';\n                    this.mines = 1;\n                    break;\n                case 'question':\n                    this.map[coor.i][coor.j].type = 'cover';\n                    break;\n            }\n        }\n\n        // for l & up\n        if (button === 'l' && method === 'up' && coor !== false) {\n            if (this.firstClick) {\n                this.firstClick = false;\n                this._setMines(coor);\n            }\n\n            if (this.map[coor.i][coor.j].number === -1) {\n                this._gameOver(coor);\n                return;\n            } else if (this.map[coor.i][coor.j].number === 0) {\n                this._expandMap(coor);\n            } else {\n                this.map[coor.i][coor.j].type = 'number';\n            }\n        }\n\n        // for lr & up\n        if (button === 'lr' && method === 'up' && coor !== false) {\n            if (this.map[coor.i][coor.j].type === 'number') {\n                // count flag around coor\n                let flags = 0;\n                for (let x = coor.i - 1; x <= coor.i + 1; x++) {\n                    for (let y = coor.j - 1; y <= coor.j + 1; y++) {\n                        if (x < this.options.rows && x >= 0 && y < this.options.columns && y >= 0 && this.map[x][y].type === 'flag') {\n                            flags++;\n                        }\n                    }\n                }\n                // show blocks around coor\n                if (flags === this.map[coor.i][coor.j].number) {\n                    for (let x = coor.i - 1; x <= coor.i + 1; x++) {\n                        for (let y = coor.j - 1; y <= coor.j + 1; y++) {\n                            if (x < this.options.rows && x >= 0 && y < this.options.columns && y >= 0 && this.map[x][y].type === 'cover') {\n                                switch (this.map[x][y].number) {\n                                    case 0:\n                                        this._expandMap({i: x, j: y});\n                                        break;\n                                    case -1:\n                                        this._gameOver({i: x, j: y});\n                                        return;\n                                    default:\n                                        this.map[x][y].type = 'number';\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        // updateframe\n        this.win = true;\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                if (this.map[i][j].number !== -1 && this.map[i][j].type !== 'number' && this.map[i][j].type !== 'blank') {\n                    this.win = false;\n                }\n                if (button === 'lr' && (method === 'down' || method === 'move')) {\n                    // for lr & down/move\n                    if (Math.abs(coor.i - i) < 2 && Math.abs(coor.j - j) < 2) {\n                        this.map[i][j].draw(true);\n                    } else {\n                        this.map[i][j].draw(false);\n                    }\n                } else if (button === 'l' && (method === 'down' || method === 'move') && this.map[i][j].type === 'cover') {\n                    // for l & down/move\n                    if (i === coor.i && j === coor.j) {\n                        this.map[i][j].draw(true);\n                    } else {\n                        this.map[i][j].draw(false);\n                    }\n                } else {\n                    // for others\n                    this.map[i][j].draw(false);\n                }\n            }\n        }\n        if (this.win) {\n            this._gameWin();\n        }\n    }\n\n    _expandMap(coor) {\n        if (coor.i < this.options.rows && coor.i >= 0 && coor.j < this.options.columns && coor.j >= 0) {\n            // in map area\n            if (this.map[coor.i][coor.j].number === 0) {\n                if (this.map[coor.i][coor.j].type !== 'blank') {\n                    // blank, expand\n                    this.map[coor.i][coor.j].type = 'blank';\n                    // expend at left, right, up, down\n                    this._expandMap({i: coor.i, j: coor.j - 1});\n                    this._expandMap({i: coor.i, j: coor.j + 1});\n                    this._expandMap({i: coor.i + 1, j: coor.j - 1});\n                    this._expandMap({i: coor.i + 1, j: coor.j + 1});\n                    this._expandMap({i: coor.i - 1, j: coor.j - 1});\n                    this._expandMap({i: coor.i - 1, j: coor.j + 1});\n                    this._expandMap({i: coor.i - 1, j: coor.j});\n                    this._expandMap({i: coor.i + 1, j: coor.j});\n                }\n            } else {\n                // number, stop expand\n                this.map[coor.i][coor.j].type = 'number';\n            }\n        }\n    }\n\n    _startGame() {\n        const timeGap = 50;\n        let lastClickButton = -1;\n        let lastClickTime = 0;\n        let timer = null;\n\n        const getBlockPosition = (x, y)=> {\n            // * 2 for retina display\n            const j = Math.floor(x / this.options.blockSize * 2);\n            const i = Math.floor(y / this.options.blockSize * 2);\n            if (i < this.options.rows && i >= 0 && j < this.options.columns && j >= 0) {\n                return {i: i, j: j};\n            } else {\n                return false;\n            }\n        };\n\n        if (document.hasOwnProperty(\"ontouchstart\")) {\n            alert('This game doesn\\'t support touch screen, please use a desktop broswer.');\n            return;\n        }\n\n        const mouseDown = (event)=> {\n            const coor = getBlockPosition(event.offsetX, event.offsetY);\n            let currentButton = null;\n            if (event.button + lastClickButton === 2 && Date.now() - lastClickTime < timeGap) {\n                // left && right click\n                clearTimeout(timer);\n                currentButton = 'lr';\n                this._updateMap(currentButton, 'down', coor);\n            } else if (event.button === 0) {\n                // left click\n                timer = setTimeout(()=> {\n                    currentButton = 'l';\n                    this._updateMap(currentButton, 'down', coor);\n                }, timeGap)\n            } else if (event.button === 2) {\n                // right click\n                timer = setTimeout(()=> {\n                    currentButton = 'r';\n                    this._updateMap(currentButton, 'down', coor);\n                }, timeGap)\n            }\n\n            lastClickTime = Date.now();\n            lastClickButton = event.button;\n\n            const mouseMove = (event)=> {\n                const coor = getBlockPosition(event.offsetX, event.offsetY);\n                if (currentButton === 'l' || currentButton === 'lr') {\n                    this._updateMap(currentButton, 'move', coor);\n                }\n            };\n\n            const mouseUp = (event)=> {\n                const coor = getBlockPosition(event.offsetX, event.offsetY);\n                if (currentButton === 'l' || currentButton === 'lr') {\n                    this._updateMap(currentButton, 'up', coor);\n                }\n\n                window.removeEventListener('mousemove', mouseMove);\n                window.removeEventListener('mouseup', mouseUp);\n            };\n\n            window.addEventListener('mousemove', mouseMove);\n            window.addEventListener('mouseup', mouseUp);\n        };\n\n        this.canvas.addEventListener('mousedown', mouseDown);\n    }\n\n    _gameOver(coor) {\n        this.gameOver = true;\n        // show all mines\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                if (i === coor.i && j === coor.j) {\n                    // the mine user clicked\n                    this.map[i][j].drawBoom();\n                } else if (this.map[i][j].number === -1) {\n                    // is mine, not shown\n                    if (this.map[i][j].type === 'cover' || this.map[i][j].type === 'question') {\n                        this.map[i][j].drawMine();\n                    }\n                } else if (this.map[i][j].type === 'flag') {\n                    // not mine, but flagged\n                    this.map[i][j].drawWrong();\n                }\n            }\n        }\n        // stop timer\n        clearInterval(this.timer);\n        // change face\n        this._face.className = 'failed';\n    }\n\n    _gameWin() {\n        // show all mines\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                if (this.map[i][j].number === -1 && this.map[i][j].type !== 'flag') {\n                    // mine, but not flagged\n                    this.map[i][j].type = 'flag';\n                    this.map[i][j].draw(false);\n                }\n            }\n        }\n        // stop timer\n        clearInterval(this.timer);\n        // clear mines\n        this._mines.innerText = '000';\n        // change face\n        this._face.className = 'win';\n    }\n\n    _addZero(data, length) {\n        length = length || 3;\n        data = data + '';\n        while (data.length < length) {\n            data = '0' + data;\n        }\n        return data;\n    }\n\n    setLevel(level) {\n        switch (level) {\n            case 'easy':\n                this.options.rows = 9;\n                this.options.columns = 9;\n                this.options.mineCount = 10;\n                break;\n            case 'normal':\n                this.options.rows = 16;\n                this.options.columns = 16;\n                this.options.mineCount = 40;\n                break;\n            case 'hard':\n                this.options.rows = 16;\n                this.options.columns = 30;\n                this.options.mineCount = 99;\n                break;\n            default:\n                console.error('minesweeper: no such difficulty');\n        }\n\n        this._initMap();\n    }\n\n    set mines(num) {\n        this._mines.innerText = this._addZero(parseInt(this._mines.innerText) + num);\n    }\n\n    set time(str) {\n        const time = parseInt(this._time.innerText) + 1;\n        if (time >= 999) {\n            clearInterval(this.timer);\n        }\n        this._time.innerText = this._addZero(time);\n    }\n\n    set options(_options) {\n        const options = {\n            gameArea: '',\n            rows: 9,\n            columns: 9,\n            mineCount: 10\n        };\n\n        for (let key in options) {\n            if (_options[key] !== undefined) {\n                options[key] = _options[key];\n            }\n        }\n        // max rows && colums && mines\n        if (options.rows > 30) {\n            options.rows = 30;\n        }\n        if (options.columns > 40) {\n            options.columns = 40;\n        }\n        if (options.rows * options.columns / 4 < options.mineCount) {\n            options.mineCount = Math.floor(options.rows * options.columns / 4);\n        }\n        // can not set by users\n        options.blockSize = 40;\n\n        this._options = options;\n    }\n\n    get options() {\n        return this._options;\n    }\n}"]}