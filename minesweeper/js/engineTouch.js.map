{"version":3,"sources":["src/engineTouch.js"],"names":[],"mappings":"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","file":"engineTouch.js","sourcesContent":["import Block from 'js/block';\n\nexport default class MineSweeper {\n    constructor(options) {\n        this.options = options;\n\n        this._initGame();\n        this.setLevel('Easy');\n        this._startGame();\n    }\n\n    _initGame() {\n        this.gameArea = document.getElementById(this.options.gameArea);\n\n        // menu\n        const menuWrapper = document.createElement('div');\n        menuWrapper.className = 'menu';\n        menuWrapper.innerHTML = '<span>Menu</span>';\n        this._menu = document.createElement('ul');\n        this._menu.innerHTML = '<li>Start</li><a class=\"gap\"></a><li class=\"current\">Easy</li><li>Normal</li><li>Hard</li><li>Custom</li>';\n        menuWrapper.appendChild(this._menu);\n        this.gameArea.appendChild(menuWrapper);\n\n        const menuButton = menuWrapper.getElementsByTagName('span')[0];\n        // event for menu show\n        menuButton.addEventListener('click', (event)=> {\n            this._menu.style.display = 'block';\n            menuButton.className = 'on';\n            event.stopPropagation();\n        });\n        // event for menu hide\n        window.addEventListener('click', (event)=> {\n            this._menu.style.display = 'none';\n            menuButton.className = '';\n        });\n        // event for menu click\n        this._menu.addEventListener('click', (event)=> {\n            if (event.srcElement.nodeName === 'LI') {\n                if (event.srcElement.innerText === 'Start') {\n                    this._initMap();\n                } else {\n                    this.setLevel(event.srcElement.innerText);\n                }\n            }\n        });\n        // for custom level setter\n        this._levelSel = document.createElement('div');\n        this._levelSel.className = 'custom-level';\n        this._levelSel.innerHTML = `\n            <form>\n                <p>Width: <input type=\"text\" title=\"width\"></p>\n                <p>Height: <input type=\"text\" title=\"height\"></p>\n                <p>Mines: <input type=\"text\" title=\"mines\"></p>\n                <div><input type=\"submit\" value=\"Submit\"></div>\n                <div><input type=\"button\" value=\"Cancel\"></div>\n            </form>`;\n        document.body.appendChild(this._levelSel);\n\n        const mainGame = document.createElement('div');\n        mainGame.className = 'main-game';\n        //mines left, face, and timer;\n        const digitalWrapper = document.createElement('div');\n        digitalWrapper.className = 'digital-wrapper';\n        this._mines = document.createElement('span');\n        this._time = document.createElement('span');\n        this._time.innerHTML = '000';\n        this._face = document.createElement('div');\n\n        digitalWrapper.appendChild(this._mines);\n        digitalWrapper.appendChild(this._face);\n        digitalWrapper.appendChild(this._time);\n        mainGame.appendChild(digitalWrapper);\n\n        this._face.addEventListener('click', ()=> {\n            this._initMap();\n        });\n\n        // game canvas\n        this.canvas = document.createElement('canvas');\n        this.canvas.innerText = 'Your browser does not support canvas, please upgrade your browser.';\n        mainGame.appendChild(this.canvas);\n\n        this.gameArea.appendChild(mainGame);\n\n        // init block\n        Block.size = this.options.blockSize;\n        Block.ctx = this.canvas.getContext('2d');\n    }\n\n    _initMap() {\n        // set mines count\n        this._mines.innerText = this._addZero(this.options.mineTotal);\n\n        this.gameArea.style.width = this.options.blockSize * this.options.columns + 'px';\n        // for retina display\n        this.canvas.width = this.options.blockSize * this.options.columns;\n        this.canvas.height = this.options.blockSize * this.options.rows;\n        this.canvas.style.width = this.options.blockSize * this.options.columns + 'px';\n        this.canvas.style.height = this.options.blockSize * this.options.rows + 'px';\n\n        this.firstTouch = true;\n        this.selectingLevel = false;\n        this.gameOver = false;\n        this.win = false;\n        this._face.className = 'normal';\n        clearInterval(this.timer);\n\n        this.map = [];\n        for (let i = 0; i < this.options.rows; i++) {\n            this.map[i] = [];\n            for (let j = 0; j < this.options.columns; j++) {\n                this.map[i][j] = new Block('cover', 0, i, j);\n                this.map[i][j].draw(false);\n            }\n        }\n    }\n\n    _setMines(coor) {\n        // generate mines\n        const mines = [];\n        for (let i = 0; i < this.options.rows * this.options.columns; i++) {\n            if (i < this.options.mineTotal) {\n                mines[i] = -1;\n            } else {\n                mines[i] = 0;\n            }\n        }\n\n        // shuffle mines\n\n        // use [Fisher-Yates shuffle] to shuffle mines\n        for (let i = this.options.rows * this.options.columns - 1; i > 0; i--) {\n            const ran = Math.floor(Math.random() * i);\n\n            let temp = mines[i];\n            mines[i] = mines[ran];\n            mines[ran] = temp;\n        }\n\n        // the block at first touch position can not be mine\n        const firstPosition = coor.i * this.options.columns + coor.j;\n        while (mines[firstPosition] === -1) {\n            const ran = Math.floor(Math.random() * this.options.rows * this.options.columns)\n            if (mines[ran] === 0) {\n                let temp = mines[firstPosition];\n                mines[firstPosition] = mines[ran];\n                mines[ran] = temp;\n            }\n        }\n\n        // set mines\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                this.map[i][j].number = mines[i * this.options.columns + j];\n            }\n        }\n\n        // calculate numbers\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                if (this.map[i][j].number !== -1) {\n                    for (let x = i - 1; x <= i + 1; x++) {\n                        for (let y = j - 1; y <= j + 1; y++) {\n                            if (x < this.options.rows && x >= 0 && y < this.options.columns && y >= 0 && this.map[x][y].number === -1) {\n                                this.map[i][j].number++;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        // set timer\n        this._time.innerText = '000';\n        this.timer = setInterval(()=> {\n            this.time = 'add';\n        }, 1000);\n    }\n\n    _updateMap(method, coor) {\n        // gameover, do not respond any touch event\n        if (this.gameOver || this.win || this.selectingLevel) {\n            return;\n        }\n\n        // for double tap on a unknown block\n        if (method === 'db' && this.map[coor.i][coor.j].type !== 'blank' && this.map[coor.i][coor.j].type !== 'number') {\n            switch (this.map[coor.i][coor.j].type) {\n                case 'cover':\n                    this.map[coor.i][coor.j].type = 'flag';\n                    this.mines = -1;\n                    break;\n                case 'flag':\n                    this.map[coor.i][coor.j].type = 'question';\n                    this.mines = 1;\n                    break;\n                case 'question':\n                    this.map[coor.i][coor.j].type = 'cover';\n                    break;\n            }\n        }\n\n        // for single touch on unknown block\n        if (coor !== false && method === 't' && this.map[coor.i][coor.j].type === 'cover') {\n            if (this.firstTouch) {\n                this.firstTouch = false;\n                this._setMines(coor);\n            }\n\n            if (this.map[coor.i][coor.j].number === -1) {\n                this._gameOver(coor);\n                return;\n            } else if (this.map[coor.i][coor.j].number === 0) {\n                this._expandMap(coor);\n            } else {\n                this.map[coor.i][coor.j].type = 'number';\n            }\n        }\n\n        // for double tap on a known block\n        if (coor !== false && method === 'db' && ( this.map[coor.i][coor.j].type === 'blank' || this.map[coor.i][coor.j].type === 'number')) {\n            if (this.map[coor.i][coor.j].type === 'number') {\n                // count flag around coor\n                let flags = 0;\n                for (let x = coor.i - 1; x <= coor.i + 1; x++) {\n                    for (let y = coor.j - 1; y <= coor.j + 1; y++) {\n                        if (x < this.options.rows && x >= 0 && y < this.options.columns && y >= 0 && this.map[x][y].type === 'flag') {\n                            flags++;\n                        }\n                    }\n                }\n                // expand map\n                if (flags === this.map[coor.i][coor.j].number) {\n                    for (let x = coor.i - 1; x <= coor.i + 1; x++) {\n                        for (let y = coor.j - 1; y <= coor.j + 1; y++) {\n                            if (x < this.options.rows && x >= 0 && y < this.options.columns && y >= 0 && this.map[x][y].type === 'cover') {\n                                switch (this.map[x][y].number) {\n                                    case 0:\n                                        this._expandMap({i: x, j: y});\n                                        break;\n                                    case -1:\n                                        this._gameOver({i: x, j: y});\n                                        return;\n                                    default:\n                                        this.map[x][y].type = 'number';\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        // updateframe\n        this.win = true;\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                if (this.map[i][j].number !== -1 && this.map[i][j].type !== 'number' && this.map[i][j].type !== 'blank') {\n                    this.win = false;\n                }\n\n                this.map[i][j].draw(false);\n            }\n        }\n        if (this.win) {\n            this._gameWin();\n        }\n    }\n\n    _expandMap(coor) {\n        if (coor.i < this.options.rows && coor.i >= 0 && coor.j < this.options.columns && coor.j >= 0) {\n            // in map area\n            if (this.map[coor.i][coor.j].number === 0) {\n                if (this.map[coor.i][coor.j].type !== 'blank') {\n                    // blank, expand\n                    this.map[coor.i][coor.j].type = 'blank';\n                    // expend at left, right, up, down\n                    this._expandMap({i: coor.i, j: coor.j - 1});\n                    this._expandMap({i: coor.i, j: coor.j + 1});\n                    this._expandMap({i: coor.i + 1, j: coor.j - 1});\n                    this._expandMap({i: coor.i + 1, j: coor.j + 1});\n                    this._expandMap({i: coor.i - 1, j: coor.j - 1});\n                    this._expandMap({i: coor.i - 1, j: coor.j + 1});\n                    this._expandMap({i: coor.i - 1, j: coor.j});\n                    this._expandMap({i: coor.i + 1, j: coor.j});\n                }\n            } else {\n                // number, stop expand\n                this.map[coor.i][coor.j].type = 'number';\n            }\n        }\n    }\n\n    _startGame() {\n        const timeGap = 300;\n        let lastTouchCoor = {i: 0, j: 0};\n        let lastTouchTime = 0;\n        let timer = null;\n\n        const getBlockPosition = (x, y)=> {\n            const j = Math.floor(x / this.options.blockSize);\n            const i = Math.floor(y / this.options.blockSize);\n            if (i < this.options.rows && i >= 0 && j < this.options.columns && j >= 0) {\n                return {i: i, j: j};\n            } else {\n                return false;\n            }\n        };\n\n        this.canvas.addEventListener('touchstart', (event)=> {\n            const coor = getBlockPosition(event.targetTouches[0].pageX - this.clientRect.left, event.targetTouches[0].pageY - this.clientRect.top);\n\n            let touchCancel = false;\n            let touchMethod = null;\n            // allow one block offset\n            console.log(Math.abs(lastTouchCoor.i - coor.i) + Math.abs(lastTouchCoor.j - coor.j));\n            console.log(Date.now() - lastTouchTime);\n            if ((Math.abs(lastTouchCoor.i - coor.i) + Math.abs(lastTouchCoor.j - coor.j) < 2) && Date.now() - lastTouchTime < timeGap) {\n                // double touch\n                clearTimeout(timer);\n                touchMethod = 'db';\n            } else {\n                // single touch\n                touchMethod = 't';\n                lastTouchCoor.i = coor.i;\n                lastTouchCoor.j = coor.j;\n            }\n            // update current touch\n            lastTouchTime = Date.now();\n\n            const touchMove = (event)=> {\n                if (touchCancel) {\n                    return;\n                }\n                var rect = event.target.getBoundingClientRect();\n                const coor = getBlockPosition(event.changedTouches[0].pageX - this.clientRect.left, event.changedTouches[0].pageY - this.clientRect.top);\n                // offset more than two blocks\n                if (Math.abs(lastTouchCoor.i - coor.i) + Math.abs(lastTouchCoor.j - coor.j) >= 2) {\n                    touchCancel = true;\n                }\n            };\n\n            const touchEnd = (event)=> {\n                if (!touchCancel) {\n                    if (touchMethod === 'db') {\n                        this._updateMap('db', coor);\n                    } else {\n                        timer = setTimeout(()=> {\n                            this._updateMap('t', coor);\n                        }, timeGap)\n                    }\n                }\n                window.removeEventListener('touchmove', touchMove);\n                window.removeEventListener('touchend', touchEnd);\n            };\n            //\n            window.addEventListener('touchmove', touchMove);\n            window.addEventListener('touchend', touchEnd);\n        });\n    }\n\n    _gameOver(coor) {\n        this.gameOver = true;\n        // show all mines\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                if (i === coor.i && j === coor.j) {\n                    // the mine user clicked\n                    this.map[i][j].drawBoom();\n                } else if (this.map[i][j].number === -1) {\n                    // is mine, not shown\n                    if (this.map[i][j].type === 'cover' || this.map[i][j].type === 'question') {\n                        this.map[i][j].drawMine();\n                    }\n                } else if (this.map[i][j].type === 'flag') {\n                    // not mine, but flagged\n                    this.map[i][j].drawWrong();\n                }\n            }\n        }\n        // stop timer\n        clearInterval(this.timer);\n        // change face\n        this._face.className = 'failed';\n    }\n\n    _gameWin() {\n        // show all mines\n        for (let i = 0; i < this.options.rows; i++) {\n            for (let j = 0; j < this.options.columns; j++) {\n                if (this.map[i][j].number === -1 && this.map[i][j].type !== 'flag') {\n                    // mine, but not flagged\n                    this.map[i][j].type = 'flag';\n                    this.map[i][j].draw(false);\n                }\n            }\n        }\n        // stop timer\n        clearInterval(this.timer);\n        // clear mines\n        this._mines.innerText = '000';\n        // change face\n        this._face.className = 'win';\n    }\n\n    _addZero(data, length) {\n        length = length || 3;\n        data = data + '';\n        while (data.length < length) {\n            data = '0' + data;\n        }\n        return data;\n    }\n\n    setLevel(level) {\n        switch (level) {\n            case 'Easy':\n                this.options.rows = 9;\n                this.options.columns = 9;\n                this.options.mineTotal = 10;\n                this._menu.innerHTML = '<li>Start</li><a class=\"gap\"></a><li class=\"current\">Easy</li><li>Normal</li><li>Hard</li><li>Custom</li>';\n                break;\n            case 'Normal':\n                this.options.rows = 16;\n                this.options.columns = 16;\n                this.options.mineTotal = 40;\n                this._menu.innerHTML = '<li>Start</li><a class=\"gap\"></a><li>Easy</li><li class=\"current\">Normal</li><li>Hard</li><li>Custom</li>';\n                break;\n            case 'Hard':\n                this.options.rows = 16;\n                this.options.columns = 30;\n                this.options.mineTotal = 99;\n                this._menu.innerHTML = '<li>Start</li><a class=\"gap\"></a><li>Easy</li><li>Normal</li><li class=\"current\">Hard</li><li>Custom</li>';\n                break;\n            case 'Custom':\n                clearInterval(this.timer);\n                this.selectingLevel = true;\n                // append current data\n                const inputs = this._levelSel.getElementsByTagName('input');\n                inputs[0].value = this.options.columns;\n                inputs[1].value = this.options.rows;\n                inputs[2].value = this.options.mineTotal;\n                // add button listener\n                inputs[3].addEventListener('click', (event)=> {\n                    this._menu.innerHTML = '<li>Start</li><a class=\"gap\"></a><li>Easy</li><li>Normal</li><li>Hard</li><li class=\"current\">Custom</li>';\n                    this._levelSel.style.display = 'none';\n                    const options = {\n                        rows: parseInt(inputs[1].value),\n                        columns: parseInt(inputs[0].value),\n                        mineTotal: parseInt(inputs[2].value)\n                    };\n                    this.options = options;\n                    this._initMap();\n                    event.preventDefault();\n                });\n                inputs[4].addEventListener('click', (event)=> {\n                    this._levelSel.style.display = 'none';\n                    this.selectingLevel = false;\n                });\n                // show level selector\n                this._levelSel.style.display = 'block';\n                return;\n            default:\n                console.error('minesweeper: no such difficulty');\n        }\n\n        window.scrollTo(0, 0);\n        this.clientRect = this.canvas.getBoundingClientRect();\n\n        this._initMap();\n    }\n\n    set mines(num) {\n        this._mines.innerText = this._addZero(parseInt(this._mines.innerText) + num);\n    }\n\n    set time(str) {\n        const time = parseInt(this._time.innerText) + 1;\n        if (time >= 999) {\n            clearInterval(this.timer);\n        }\n        this._time.innerText = this._addZero(time);\n    }\n\n    set options(_options) {\n        const options = {\n            gameArea: '',\n            rows: 0,\n            columns: 0,\n            mineTotal: 0\n        };\n\n        for (let key in options) {\n            if (_options[key] !== undefined) {\n                options[key] = _options[key];\n            }\n        }\n        // max/min rows && colums && mines\n        if (options.rows > 30) {\n            options.rows = 30;\n        }\n        if (options.rows < 9) {\n            options.rows = 9;\n        }\n        if (options.columns > 40) {\n            options.columns = 40;\n        }\n        if (options.columns < 9) {\n            options.columns = 9;\n        }\n        if (options.mineTotal > options.rows * options.columns / 4) {\n            options.mineTotal = Math.floor(options.rows * options.columns / 4);\n        }\n        if (options.mineTotal < options.rows * options.columns / 8) {\n            options.mineTotal = Math.floor(options.rows * options.columns / 8);\n        }\n        // can not set by users\n        options.blockSize = 40;\n\n        this._options = options;\n    }\n\n    get options() {\n        return this._options;\n    }\n}"]}